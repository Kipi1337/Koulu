# Documentation for E07

Start here...

Valmistellaan topologiaa
## topologia
![1](/documentation/E07/E07alku.drawio)
![2](/documentation/E07/E07gip.drawio)
![3](/documentation/E07/E07STP.drawio)

## Varoitus! Ole tarkkana; päivitä jatkuvasti topologiakuvaasi, kun muuttelet virtuaalikoneiden verkkorajapintojen asetuksia.
Topologia on suunniteltu

## Ole varma että käsittelet tietoverkkoasi yksi kytkin päällä kerrallaan. Ettet vahingossa törmää silmukkaan etukäteen.
    Lisää kloonaamalla kolmas kytkin topologiaasi kuten kuvio esittää
        muista uudelleenkonfiguroida kytkin 3
    Siirrä toinen lubuntu virtuaalikone kolmannen kytkimen taakse
    Kytkin on kloonattu ja portit laitettu kuntoon


![sw3](/documentation/E07/switch3luonti.png)

## Konfiguroi kaikkien kytkimien VLAN tagged/untagged asetukset uuden topologian mukaisesti.

    Testaa konfiguraatiotasi kytkin Switch1 ja Switch2 päällä (Switch 3 pois päältä)
        Voiko Lubuntu1 pingata oletusyhdyskäytäväänsä? kyllä
    Testaa konfiguraatiotasi kytkin Switch3 ja Switch2 päällä (Switch1 pois päältä)
        Voiko Lubuntu2 pingata oletusyhdyskäytäväänsä? kyllä... Heti kun muutin portit oikeiksi
    Kun konfiguraatio on toimiva, voit edetä seuraavaan kohtaan.
## ping lubuntu1->sw1->sw2->vyos oletusyhdyskäytävä

![sw1-2ping](/documentation/E07/sw1-2oletusyhdstktv.png)

## ping lubuntu2->sw3->sw2->vyos oletusyhdyskäytävä

![sw2-3ping](/documentation/E07/sw2-3oltusyhdktv.png)

## Tehdään silmukka

    Käynnistä Lubuntut ja Vyos
        Laita Lubuntu virtuaalikoneet pingaamaan toisiaan
    Avaa Tehtävienhallinta (eng. Task Manager) tietokoneeltasi
    Käynnistä kaikki kytkimet yksi kerrallaan
    Vahvista kuinka kytkimet toimivat silmukkatilanteessa
        show ports statistics -komento kytkimen konsolista
            Komennossa pitäisi näkyä transmitted packets lukemassa rivakka nousu
        The Task Manager
            Tarkkaile prosessrin (CPU:n) käyttöä täältä
        Konfiguroidaan STP



## Tältä tilanteen pitäisi näyttää

    1.ping loppuu välittömästi. saattaa tulla !DUP rivejä lopussa
    2.CPU -> Spike
    3.stops when switch powered off
    Jos koet epävakautta/katkoksia kytkimissä; sammuta kytkin virtualbox:n ikkunasta
    Tämä lopettaa yleislähetysmyrskyn.

## koneessa oli liikaa hevosia peltikuoressa
![silmukka](/documentation/E07/silmukka.png)

    !! Tilanne ei aiheuttanut piikkiä CPU:n käytössä mutta paketeista tuli duplikaatteja !!

## Laitetaan STP päälle

    Käynnistä kytkimet yksi kerrallaan
    Laita Spanning-Tree Protocol päälle kaikissa VLANeissa kaikissa kytkimissä
    Laita Spanning-Tree Protocol päälle kaikissa kytkimissä
    Kun valmista, tallenna konfiguraatio ja käynnistä kaikki kytkimet
    Aloita jälleen liikennöinti lubuntulta toiselle
        Ensiksi meidän täytyy määrittää että haluamme käyttää STP:tä kytkimen porteissa. Suositeltavaa on lisätä STP kaikkiin VLANeihin.
    configure stpd s0 add vlan <name> ports all
    Etukäteen suunnitellulla ja valitulla juurikytkimellä pelkästään tiputamme priorityn alemmaksi
    configure stpd s0 priority 4096
    Sitten laitamme STP:n päälle kytkimeen.
    enable stpd s0
    Sitten voimme tarkastella kytkimemme tilaa komennolla
    show stpd s0
    show stpd s0 ports

## switchien konfigurointi toistettiin jokaiselle switchille

![stpd](/documentation/E07/switch1STPD.png)

![show](/documentation/E07/sw1show.png)



    Tarkkaile Task Manager:sta CPU:n käyttöä.
    Tutkitaan porttien tiloja

    Tulosta kaikki porttien tilat kaikilta kytkimiltä komennoilla: show stpd s0 ja show stpd s0 ports
    Päivitä/Piirrä Spanning-Tree topologiakuva
        Mikä/Missä on juurikytkin?
    SW2
        Mitkä ovat porttien tilat jokaisella kytkimellä?
    sw2(root) päästää eDap jokasuuntaan.
    sw3 ports 1-2 eDap ja port 3 eRap.
    sw1 port 1 eDap ja port 2 eRap

        Vinkki: Esimerkkikuva on annettuna teoriamateriaalissa
    Vastaa kysymykseen: Onko juurikytkimen sijanti ihanteellinen? Edelleenlähettävätkö (porttien tiloista päätellen) kytkimet kuten   
    olisit odottanut? !! jotenkin niin sen ajattelin kun se menikin mutta olin hetken hukassa pitikö RP/DP portit itse määritellä

## Määritellään juurikytkin

    Suunnittele päivitys kytkinverkkoon konfiguroimalla Spanning-Tree kytkinprioriteetit
    Kytkinten uudelleenkäynnistys vaaditaan että juurikytkin tulee valituksi uudelleen
    Tulosta ulos kaikki show stpd s0 ja show stpd s0 ports tulosteet kytkimistä
    Piirrä/päivitä Spanning-Tree kuva uudelleen muutosten jälkeen

![root](/documentation/E07/switch2rootstpd.png)

![root](/documentation/E07/sw22rootstpdports.png)

## tilanne ennen disablointia

![bef](/documentation/E07/ennendisablointia.png)

![bef](/documentation/E07/showportsennendis.png)

## Mitataan muutosten vaikutukset topologiassa

    Laita yksi Lubuntu -työasema aktiivisesti pingaamaan toista työasemaa
    Valitse yksi porteista juurikytkimeltä ja laita se pois päältä komennolla disable port <#>
    Mittaa ja dokumentoi katkos ping:stä laitteiden välillä
        !! Sinun mahdollisesti täytyy enabloida/disabloida portti useita kertoja, jotta saat toivotun vaikutuksen
    Tulosta ulos kaikki show stpd s0 ja show stpd s0 ports tulosteet kytkimistä
    Piirrä/päivitä Spanning-Tree kuva uudelleen portin poispäältä laittamisen jälkeen

![dis](/documentation/E07/showports2dis.png)

![dis](/documentation/E07/showstpddis2.png)

## Kokeilin myös disablointia toisella switchillä
![!](/documentation/E07/toisellaswitchillä diablointi.png)

## ja sitten disabloin vielä kerran root switchiltä portin

![?](/documentation/E07/onemoretest.png)
    pingi katkoksessa haisee joku vähän väärältä mutta en oikein osaa laittaa sormea siihen missä mahdollinen konflikti on tapahtunut

 ## ping katkos pitäisi näkyä seuraavasti

    64 bytes from 192.168.0.254: icmp_seq=2022 ttl=64 time=3.99 ms
    64 bytes from 192.168.0.254: icmp_seq=2023 ttl=64 time=3.11 ms
    64 bytes from 192.168.0.254: icmp_seq=2024 ttl=64 time=3.00 ms
    64 bytes from 192.168.0.254: icmp_seq=2025 ttl=64 time=3.68 ms
    64 bytes from 192.168.0.254: icmp_seq=2031 ttl=64 time=1.89 ms
    64 bytes from 192.168.0.254: icmp_seq=2032 ttl=64 time=2.63 ms
    64 bytes from 192.168.0.254: icmp_seq=2033 ttl=64 time=1.94 ms
    eli paketit 2026 - 2030 on kadonnut matkalta kun portti on disabloitu
    ja
    64 bytes from 192.168.0.254: icmp_seq=2034 ttl=64 time=1.86 ms
    64 bytes from 192.168.0.254: icmp_seq=2035 ttl=64 time=2.35 ms
    64 bytes from 192.168.0.254: icmp_seq=2036 ttl=64 time=1.69 ms
    64 bytes from 192.168.0.254: icmp_seq=2037 ttl=64 time=2.22 ms
    64 bytes from 192.168.0.254: icmp_seq=2038 ttl=64 time=1.82 ms
    64 bytes from 192.168.0.254: icmp_seq=2043 ttl=64 time=3.18 ms
    64 bytes from 192.168.0.254: icmp_seq=2044 ttl=64 time=1.56 ms
    Eli paketit 2039 - 2042 katoaa kun portti enabloidaan
    Mittaa sama katkos sinun topologiastasi!
